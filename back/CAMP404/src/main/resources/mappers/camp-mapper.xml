<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- namespace 추가하기 -->
<mapper namespace="campMapper">

<!-- <cache-ref namespace=""/> : 지우기 -->

<resultMap type="camp" id="camp_rm">
<id property="userNo" column="USER_NO"/>
<result property="userId" column="USER_ID"/>
<result property="userPw" column="USER_PW"/>
<result property="userName" column="USER_NAME"/>
<result property="userEmail" column="USER_EMAIL"/>
<result property="userNick" column="USER_NICK"/>
<result property="userTel" column="USER_TEL"/>
<result property="userAddress" column="USER_ADDR"/>
<result property="enrollDate" column="ENROLL_DT"/>
<result property="secessionFlag" column="SECESSION_FL"/>
</resultMap>




<!--  사용자 -->
	<resultMap type="users" id="users_rm">
		<id property="userNo" column="USER_NO"/>
		<result property="userId" column="USER_ID" />
		<result property="userPw" column="USER_PW" />
		<result property="userName" column="USER_NAME" />
		<result property="userEmail" column="USER_EMAIL" />
		<result property="userNick" column="USER_NICK" />
		<result property="userTel" column="USER_TEL" />
		<result property="userAddress" column="USER_ADDR" />
		<result property="enrollDate" column="ENROLL_DT" />
		<result property="secessionFlag" column="SECESSION_FL" />
				<result property="mail_key" column="mail_key" />
				<result property="mail_auth" column="mail_auth" />		
	</resultMap>
	
	<!-- 강사 -->
	<resultMap type="teacher" id="teacher_rm">
		<id property="teacherNo" column="TEACHER_NO"/>
		<result property="teacherId" column="TEACHER_ID" />
		<result property="teacherPw" column="TEACHER_PW" />	
		<result property="teacherName" column="TEACHER_NAME" />
		<result property="teacherEmail" column="TEACHER_EMAIL" />
		<result property="teacherTel" column="TEACHER_TEL" />
		<result property="teacherAddress" column="TEACHER_ADDR" />
		<result property="teacherenrollDate" column="ENROLL_DT" />
		<result property="secessionFlag" column="SECESSION_FL" />
	</resultMap>
	
	<!-- 강의노트 -->
	<resultMap type="lectureNote" id="lectureNote_rm">
		<id property="noteNo" column="NOTE_NO"/>
		<result property="noteContent" column="NOTE_CONTENT" />
		<result property="usersNo" column="USERS_NO" />
		<result property="lectureNo" column="LECTURE_NO" />
	</resultMap>
	
	<!-- 이메일인증 -->
	<resultMap type="certification" id="certification_rm">
		<id property="cEmail" column="C_EMAIL"/>
		<result property="cNumber" column="C_NUMBER" />
		<result property="issueDate" column="ISSU_DT" />
	</resultMap>
	
	<!-- 강의 -->
	<resultMap type="lecture" id="lecture_rm">
		<id property="lectureNo" column="LECTURE_NO"/>
		<result property="lectureName" column="LECTURE_NAME" />
		<result property="uploadDate" column="UPLOAD_DATE" />
		<result property="viewCount" column="VIEW_CNT" />
		<result property="price" column="PRICE" />
		<result property="teacherNo" column="TEACHER_NO" />
		<result property="categoryNo" column="CATEGORY_NO" />
	</resultMap>
	
	<!-- 카테고리 -->
	<resultMap type="category" id="category_rm">
		<id property="categoryNo" column="CATEGORY_NO"/>
		<result property="categoryName" column="CATEGORY_NAME" />
	</resultMap>
	
	<!-- 내강의 -->
	<resultMap type="mylecture" id="mylecture_rm">
		<id property="usersNo" column="USERS_NO"/>
		<result property="lectureNo" column="LECTURE_NO" />
		<result property="favNo" column="PAY_NO" />
	</resultMap>
	
	<!-- 찜목록 -->
	<resultMap type="favlec" id="favlec_rm">
		<id property="favNo" column="FAV_NO"/>
		<result property="favYn" column="FAV_YN" />
		<result property="lectureNo" column="LECTURE_NO" />
		<result property="usersNo" column="USERS_NO" />
	</resultMap>
	
	<!-- 결제 -->
	<resultMap type="payment" id="payment_rm">
		<id property="payNo" column="PAY_NO"/>
		<result property="payWay" column="PAY_WAY" />
		<result property="payDate" column="PAY_DATE" />
		<result property="payPrice" column="PAY_PRICE" />
		<result property="usersNo" column="USERS_NO" />
		<result property="lectureNo" column="LECTURE_NO" />
	</resultMap>
	
	<!-- 관리자 -->
	<resultMap type="manager" id="manager_rm">
		<id property="mgrNo" column="MGR_NO"/>
		<result property="mgrName" column="MGR_NAME" />
		<result property="mgrId" column="MGR_ID" />
		<result property="mgrPw" column="MGR_PW" />
	</resultMap>
	
	<!-- 공지사항 -->
	<resultMap type="notice" id="notice_rm">
		<id property="noticeNo" column="NOTICE_NO"/>
		<result property="noticeTitle" column="NOTICE_TITLE" />
		<result property="noticeContent" column="NOTICE_CONTENT" />
		<result property="noticeDate" column="NOTICE_DATE" />
		<result property="mgrNo" column="MGR_NO" />
	</resultMap> 









<!--  parameterType="camp.kh.semi.member.model.vo.Camp"-->
<select id="login" parameterType="camp" resultMap="camp_rm">
SELECT USER_NO,
USER_ID,
USER_NAME,
USER_EMAIL,
USER_NICK,
USER_TEL,
USER_ADDR,
TO_CHAR(ENROLL_DT, 'YYYY-MM-DD HH24:MI:SS') AS ENROLL_DT
FROM USERS
WHERE USER_ID = #{userId}
AND USER_PW = #{userPw}
AND SECESSION_FL = 'N'
</select>


<!-- 공지사항 글등록 -->
<insert id="noticeWriteForm">
	INSERT INTO NOTICE(NOTICE_NO  ,NOTICE_TITLE, NOTICE_CONTENT, MANAGER_NO) 
	VALUES(
	${noticeNo}, 
	#{noticeTitle}, 
	#{noticeContent},
	1);
</insert>


<!-- 게시글 조회 -->
<select id="noticeList" resultType="notice" resultMap="notice_rm">
	select * from NOTICE;
</select>


    <!-- 회원가입 시 이메일 인증을 위한 랜덤번호 저장 -->
    <update id="updateMailKey" parameterType="users_rm">
        update member set #{mail_key} where #{userEmail} and #{userId}
    </update>

    <!-- 메일인증을 하면 mail_auth 컬럼을 기본값0에서 1로 바꿔 로그인을 허용 -->
    <update id="updateMailAuth" parameterType="users_rm">
	    update member set #{mail_auth}=1 where #{userEmail} and #{mail_key}
    </update>

    <!-- 이메일 인증을 안했으면 0을 반환, 로그인 시 인증 했나 안했나 체크하기 위함 -->
    <select id="emailAuthFail" parameterType="String" resultType="int">
        select count(*) from member where #{userId} and #{mail_auth}=1
    </select>






</mapper>